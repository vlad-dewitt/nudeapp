{
  "version": 3,
  "file": "image_selector.js",
  "sourceRoot": "../../../..",
  "sources": [
    "coffee/imports/ui/parts/image_selector.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "ImageSelector = class extends PureComponent\n  constructor: (props) ->\n    super props\n    @state =\n      objects: []\n      selected: {}\n      after: null\n      has_next_page: yes\n\n\n\n  componentDidMount: =>\n    @getPhotos()\n\n  componentDidUpdate: (prevProps, prevState) =>\n    if @state.selected isnt prevState.selected\n      selectedPhotos = @state.objects.filter (item, index) =>\n        @state.selected[index]\n\n      Ambry.call 'setImageSelector',\n        active: yes\n        objects: selectedPhotos\n\n  componentWillUnmount: =>\n    Ambry.call 'setImageSelector',\n      active: no\n      objects: []\n\n\n\n  getPhotos: =>\n    params =\n      first: 120\n      mediaType: ['photo', 'video']\n      sortBy: ['creationTime']\n\n    if @state.after\n      params.after = @state.after\n\n    if not @state.has_next_page\n      no\n    else\n      MediaLibrary.getAssetsAsync params\n      .then (res) =>\n        @processImages res\n\n\n  processImages: (images) =>\n    if @state.after is images.endCursor\n      return\n    else\n      @setState\n        objects: [@state.objects..., images.assets...]\n        after: images.endCursor\n        has_next_page: images.hasNextPage\n\n  selectImage: (index) =>\n    newSelected = { @state.selected... }\n\n    if newSelected[index]\n      delete newSelected[index]\n    else\n      newSelected[index] = yes\n\n    if not newSelected\n      newSelected = {}\n\n    @setState\n      selected: newSelected\n\n\n\n  render: =>\n    <View style={ Shape.Box }>\n      <FlatList data={ @state.objects } numColumns={ 4 } initialNumToRender={ 40 } onEndReachedThreshold={ .5 } renderItem={ ({ item, index }) =>\n        <ImageTile object={ item } index={ index } selected={ if @state.selected[index] then yes else no } selectImage={ @selectImage }/>\n      } keyExtractor={ (path, index) => index } onEndReached={ @getPhotos } extraData={ @state.selected }/>\n    </View>\n\n\n\nImageTile = class extends PureComponent\n  constructor: (props) ->\n    super props\n\n  render: =>\n    if not @props.object\n      null\n    else\n      <TouchableOpacity activeOpacity={ .7 } onPress={ @props.selectImage.bind this, @props.index }>\n        <View>\n          <Image style={{ width: Dimensions.get('window').width / 4, height: Dimensions.get('window').width / 4 }} source={{ uri: @props.object.uri }}/>\n          {\n            if @props.object.mediaType is 'video'\n              <View style={{ position: 'absolute', zIndex: 10, width: 24, height: 24, bottom: 4, right: 6, alignItems: 'center', justifyContent: 'center' }}>\n                <Image source={ Assets.img.icons.video_linear_icon } style={{ width: '100%', height: '100%', resizeMode: 'contain' }}/>\n              </View>\n          }\n          {\n            if @props.selected\n              <View style={{ position: 'absolute', zIndex: 10, top: 0, left: 0, bottom: 0, right: 0, backgroundColor: 'rgba(250, 217, 217, .8)', alignItems: 'center', justifyContent: 'center' }}>\n                <Image source={ Assets.img.icons.selected } style={{ width: 64, height: 64, resizeMode: 'contain' }}/>\n              </View>\n          }\n        </View>\n      </TouchableOpacity>\n\n\n\nShape = StyleSheet.create\n  Box:\n    flex: 1\n    width: '100%'\n\n\n\nexport default Hybrid withNavigation ImageSelector\n"
  ]
}